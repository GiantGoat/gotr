# copied from http://craychee.io/blog/2015/04/11/circleci/
machine:
  environment:
    SERVER: giantgoat.local
  php:
    version: 5.5.21
  hosts:
    SERVER: 127.0.0.1

dependencies:
  pre:

  # Wraith set up
  # - sudo apt-get build-essential chrpath libssl-dev libxft-dev imagemagick libfreetype6 libfreetype6-dev libfontconfig1 libfontconfig1-dev
  - npm install -g phantomjs

  # - sudo apt-get install imagemagick phantomjs
  # - gem install wraith

#    - cp cnf/circle.conf /etc/apache2/sites-available/default
#    - sudo sed -e "s?%HOME%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
#     - sudo sed -e "s?%PROJECT_DIR%?www?g" --in-place /etc/apache2/sites-available/default
#     - sudo sed -e "s?%SERVER%?SERVER?g" --in-place /etc/apache2/sites-available/default
#     - sudo a2enmod rewrite
#     - sudo service apache2 restart
#     - cp cnf/settings.php www/sites/default
#   override:
#     - composer install --prefer-dist
#   post:
#     - sudo chown -R $(whoami):www-data www
#     - build/install.sh

  test:
     override:
       - phantomjs --version
      #  - wraith capture config/configs.yaml
        #  - bin/behat -f pretty
#          - cd www && ../bin/drush fl | grep -qi 'overridden' && (echo 'Feature override test: fail' && exit 0) || (echo 'Feature override: pass' && exit 1)
